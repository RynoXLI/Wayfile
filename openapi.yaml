components:
  schemas:
    DocumentResponse:
      additionalProperties: false
      properties:
        $schema:
          description: A URL to the JSON Schema for this object.
          example: http://localhost:8080/schemas/DocumentResponse.json
          format: uri
          readOnly: true
          type: string
        checksum_sha256:
          description: SHA-256 checksum
          example: e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855
          type: string
        created_at:
          description: Creation timestamp
          example: "2024-01-15T10:00:00Z"
          format: date-time
          type: string
        download_url:
          description: Pre-signed download URL
          example: http://localhost:8080/api/v1/ns/my-namespace/documents/123e4567-e89b-12d3-a456-426614174000?token=abc.def.123.sig
          type: string
        file_name:
          description: Original filename
          example: document.pdf
          type: string
        id:
          description: Document UUID
          example: 123e4567-e89b-12d3-a456-426614174000
          type: string
        title:
          description: Document title
          example: document.pdf
          type: string
      required:
        - id
        - file_name
        - title
        - checksum_sha256
        - download_url
        - created_at
      type: object
    ErrorDetail:
      additionalProperties: false
      properties:
        location:
          description: Where the error occurred, e.g. 'body.items[3].tags' or 'path.thing-id'
          type: string
        message:
          description: Error message text
          type: string
        value:
          description: The value at the given location
      type: object
    ErrorModel:
      additionalProperties: false
      properties:
        $schema:
          description: A URL to the JSON Schema for this object.
          example: http://localhost:8080/schemas/ErrorModel.json
          format: uri
          readOnly: true
          type: string
        detail:
          description: A human-readable explanation specific to this occurrence of the problem.
          example: Property foo is required but is missing.
          type: string
        errors:
          description: Optional list of individual error details
          items:
            $ref: "#/components/schemas/ErrorDetail"
          nullable: true
          type: array
        instance:
          description: A URI reference that identifies the specific occurrence of the problem.
          example: https://example.com/error-log/abc123
          format: uri
          type: string
        status:
          description: HTTP status code
          example: 400
          format: int64
          type: integer
        title:
          description: A short, human-readable summary of the problem type. This value should not change between occurrences of the error.
          example: Bad Request
          type: string
        type:
          default: about:blank
          description: A URI reference to human-readable documentation for the error.
          example: https://example.com/errors/example
          format: uri
          type: string
      type: object
    HealthOutputBody:
      additionalProperties: false
      properties:
        $schema:
          description: A URL to the JSON Schema for this object.
          example: http://localhost:8080/schemas/HealthOutputBody.json
          format: uri
          readOnly: true
          type: string
        status:
          description: Service status
          example: ok
          type: string
      required:
        - status
      type: object
info:
  description: Document storage and management API
  license:
    name: Apache 2.0
    url: http://www.apache.org/licenses/LICENSE-2.0.html
  title: Wayfile Document API
  version: 0.1.0
openapi: 3.0.3
paths:
  /api/v1/ns/{namespace}/documents:
    post:
      description: Upload a file to the specified namespace
      operationId: upload-document
      parameters:
        - description: Namespace name
          in: path
          name: namespace
          required: true
          schema:
            description: Namespace name
            maxLength: 255
            type: string
      requestBody:
        content:
          multipart/form-data:
            encoding:
              file:
                contentType: application/octet-stream
            schema:
              properties:
                file:
                  contentEncoding: binary
                  contentMediaType: application/octet-stream
                  description: File to upload
                  format: binary
                  type: string
              required:
                - file
              type: object
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DocumentResponse"
          description: OK
        default:
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ErrorModel"
          description: Error
      summary: Upload a document
      tags:
        - documents
  /api/v1/ns/{namespace}/documents/{documentID}:
    delete:
      description: Delete a file from the specified namespace
      operationId: delete-document
      parameters:
        - description: Namespace name
          in: path
          name: namespace
          required: true
          schema:
            description: Namespace name
            maxLength: 255
            type: string
        - description: Document UUID
          in: path
          name: documentID
          required: true
          schema:
            description: Document UUID
            format: uuid
            type: string
      responses:
        "204":
          description: No Content
        default:
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ErrorModel"
          description: Error
      summary: Delete a document
      tags:
        - documents
    get:
      description: Download a file from the specified namespace
      operationId: download-document
      parameters:
        - description: Namespace name
          in: path
          name: namespace
          required: true
          schema:
            description: Namespace name
            maxLength: 255
            type: string
        - description: Document UUID
          in: path
          name: documentID
          required: true
          schema:
            description: Document UUID
            format: uuid
            type: string
        - description: Pre-signed token for authentication
          explode: false
          in: query
          name: token
          schema:
            description: Pre-signed token for authentication
            type: string
      responses:
        "200":
          description: OK
        default:
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ErrorModel"
          description: Error
      summary: Download a document
      tags:
        - documents
  /health:
    get:
      description: Check if the API server is running and dependencies are healthy
      operationId: get-health
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HealthOutputBody"
          description: OK
        default:
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ErrorModel"
          description: Error
      summary: Health check
      tags:
        - health
servers:
  - url: http://localhost:8080
